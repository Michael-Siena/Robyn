<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-features">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Features | Robyn</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://facebookexperimental.github.io/Robyn/docs/features"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Features | Robyn"><meta data-rh="true" name="description" content="An in-depth discussion of both the implementation and technical underpinnings of Robyn follows -"><meta data-rh="true" property="og:description" content="An in-depth discussion of both the implementation and technical underpinnings of Robyn follows -"><link data-rh="true" rel="icon" href="/Robyn/img/robyn_logo.png"><link data-rh="true" rel="canonical" href="https://facebookexperimental.github.io/Robyn/docs/features"><link data-rh="true" rel="alternate" href="https://facebookexperimental.github.io/Robyn/docs/features" hreflang="en"><link data-rh="true" rel="alternate" href="https://facebookexperimental.github.io/Robyn/docs/features" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-TMZK4YFDGL","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TMZK4YFDGL"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-TMZK4YFDGL",{anonymize_ip:!0})</script><link rel="stylesheet" href="/Robyn/assets/css/styles.6cb97e72.css">
<link rel="preload" href="/Robyn/assets/js/runtime~main.8e2b16e5.js" as="script">
<link rel="preload" href="/Robyn/assets/js/main.4504c918.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#20232a;color:#fff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">Support Ukraine ðŸ‡ºðŸ‡¦ <a target="_blank" rel="noopener noreferrer" href="https://opensource.facebook.com/support-ukraine"> Help Provide Humanitarian Aid to Ukraine</a>.</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Robyn/"><div class="navbar__logo"><img src="/Robyn/img/robyn_logo.png" alt="Robyn Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/Robyn/img/robyn_logo.png" alt="Robyn Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Robyn</b></a><a class="navbar__item navbar__link" href="/Robyn/docs/quick-start/">Docs</a><a class="navbar__item navbar__link" href="/Robyn/docs/about">About</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookexperimental/Robyn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/Robyn/docs/quick-start">How-to guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Robyn/docs/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Robyn/docs/additional-materials">Additional Materials</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Robyn/docs/e-learning-course">Robyn E-learning Course</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Robyn/docs/analysts-guide-to-MMM">Analysts guide to MMM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/Robyn/docs/features">Features</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Robyn/docs/releases">Releases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Robyn/docs/success-stories">Success Stories using Robyn</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Robyn/docs/contributing">Getting help and contributing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Robyn/docs/about">About Robyn</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Robyn/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Features</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Features</h1></header><p>An in-depth discussion of both the implementation and technical underpinnings of Robyn follows -</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="model-inputs">Model Inputs<a href="#model-inputs" class="hash-link" aria-label="Direct link to Model Inputs" title="Direct link to Model Inputs">â€‹</a></h2><p>The function <code>robyn_inputs()</code> mainly captures all model specification for the dataset. Here we break down some of the underlying concepts</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">InputCollect &lt;- robyn_inputs(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dt_input = dt_simulated_weekly</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,dt_holidays = dt_prophet_holidays</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,date_var = &quot;DATE&quot; # date format must be &quot;2020-01-01&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,dep_var = &quot;revenue&quot; # there should be only one dependent variable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,dep_var_type = &quot;revenue&quot; # &quot;revenue&quot; or &quot;conversion&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,prophet_vars = c(&quot;trend&quot;, &quot;season&quot;, &quot;holiday&quot;) # &quot;trend&quot;,&quot;season&quot;, &quot;weekday&quot; &amp; &quot;holiday&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,prophet_country = &quot;DE&quot;# input one country. dt_prophet_holidays includes 59 countries by default</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,context_vars = c(&quot;competitor_sales_B&quot;, &quot;events&quot;) # e.g. competitors, discount, unemployment etc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,paid_media_spends = c(&quot;tv_S&quot;,&quot;ooh_S&quot;,&quot;print_S&quot;,&quot;facebook_S&quot;, &quot;search_S&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,paid_media_vars = c(&quot;tv_S&quot;, &quot;ooh_S,&quot;print_S&quot;,&quot;facebook_I&quot;,&quot;search_clicks_P&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,organic_vars = c(&quot;newsletter&quot;) # marketing activity without media spend</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,factor_vars = c(&quot;events&quot;) # specify which variables in context_vars or organic_vars are factorial</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,window_start = &quot;2016-01-01&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,window_end = &quot;2018-12-31&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,adstock = &quot;geometric&quot; # geometric, weibull_cdf or weibull_pdf.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="paid-media-variables">Paid Media Variables<a href="#paid-media-variables" class="hash-link" aria-label="Direct link to Paid Media Variables" title="Direct link to Paid Media Variables">â€‹</a></h3><p>Refer to the <a href="https://facebookexperimental.github.io/Robyn/docs/analysts-guide-to-MMM#data-collection" target="_blank" rel="noopener noreferrer">Data Collection</a> section of the Analyst&#x27;s Guide to MMM for a detailed discussion on best practices for selecting your paid media variables.</p><p>For paid media variables, we currently require that users designate both <code>paid_media_vars</code> and <code>paid_media_spends</code>. These vectors should be of the same length, and the elements in the same positions in each list should correspond (e.g. if element 2 in paid_media_vars is your tv variable, then element 2 in paid_media_spends should be your spend that corresponds to that tv data)</p><p>When exposure metrics are provided in <code>paid_media_vars</code>, Robyn will fit them against their corresponding spend using the Michaelis-Menten nonlinear fitting. If the fit is low, it indicates that exposure metrics have different underlying pattern than their spends. Therefore, Robyn will recommend to splitting the channel for potentially better modelling result. Take Meta as example, retargeting and prospecting campaigns might have very different CPMs and efficiencies. In which case, it would be meaningful to split Meta by retargeting and prospecting.</p><p>Ensure that the paid media data is complete and accurate before proceeding. We will talk more about the variable transformations paid media variables will be subject to in the Variable Transformation section.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="organic-variables">Organic Variables<a href="#organic-variables" class="hash-link" aria-label="Direct link to Organic Variables" title="Direct link to Organic Variables">â€‹</a></h3><p>Robyn enables users to specify <code>organic_vars</code> to model marketing activities without direct spend. Typically, this may include newsletter, push notification, social media posts, among other efforts. Moreover, organic variables are expected to have similar carryover (adstock) and saturating behavior as paid media variables. The respective transformation techniques such as geometric or Weibull transformation for adstock; or Hill transformation for saturation, are also applied to organic variables. More on these transformations in the following section -</p><hr><h4 class="anchor anchorWithStickyNavbar_LWe7" id="examples-of-typical-organic-variables">Examples of typical organic variables<a href="#examples-of-typical-organic-variables" class="hash-link" aria-label="Direct link to Examples of typical organic variables" title="Direct link to Examples of typical organic variables">â€‹</a></h4><ul><li>Reach / Impressions on blog posts</li><li>Impressions on organic &amp; unpaid social media</li><li>SEO improvements</li><li>Email campaigns</li><li>Reach on UGC</li></ul><p>Below a chart showing the different types of organic variables that could be modeled</p><img loading="lazy" alt="organic media" src="/Robyn/img/organic-media.png" class="img_ev3q"><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="contextual-variables">Contextual Variables<a href="#contextual-variables" class="hash-link" aria-label="Direct link to Contextual Variables" title="Direct link to Contextual Variables">â€‹</a></h3><p>All contextual variables must be specified as elements in <code>context_vars</code>. For a detailed discussion on potential contextual variables to include in your model, see the <a href="https://facebookexperimental.github.io/Robyn/docs/analysts-guide-to-MMM#data-collection" target="_blank" rel="noopener noreferrer">Data Collection</a> section of the Analyst&#x27;s guide to MMM.</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="variable-transformations">Variable Transformations<a href="#variable-transformations" class="hash-link" aria-label="Direct link to Variable Transformations" title="Direct link to Variable Transformations">â€‹</a></h2><p>MMM is typlically characterised by the following two hypothesis:</p><ol><li>Ads investment has lagged effect / carries over through time. For example, I see ads today and buy next week.</li><li>Ads investment has diminishing returns. For example, the more I spent on a channel, the less marginal return I will get.</li></ol><p>Robyn conducts two types of transformation to account for these hypothesis:</p><ol><li>Adstock transformation</li><li>Saturation transformation</li></ol><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adstock">Adstock<a href="#adstock" class="hash-link" aria-label="Direct link to Adstock" title="Direct link to Adstock">â€‹</a></h3><p>Adstock refers to the hypothesis of ads carryover and reflects the theory that the effects of advertising can lag and
decay following initial exposure. It&#x27;s also related to certain brand equity metrics like ad-recall or campaign awareness. The logical narrative is &quot;I saw the ads X days ago before I bought the product&quot;. Usually, it&#x27;s assumed that this &quot;memory&quot; decays as time passes. But there&#x27;re also cases when it&#x27;s legitimate to assume that the effect of this &quot;memory&quot; will increase first before decreasing. For example, expensive products like cars or credits are unlikely to be purchased directly after the ads, esp. for offline channels. Therefore, it&#x27;s usual to assume lagged effect with later peaks for offline channels for these products. At the same time, online conversions from digital channels might be suitable without lagged peaks and only deal with decay.</p><p>There are three adstock transformation options you can choose in Robyn:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="geometric">Geometric:<a href="#geometric" class="hash-link" aria-label="Direct link to Geometric:" title="Direct link to Geometric:">â€‹</a></h4><p>   The one-parametric exponential decay function is used with theta as the fixed-rate decay parameter. For example, an adstock of theta =
0.75 means that 75% of the ads in Period 1 carryover to Period 2. Robyn&#x27;s implementation of Geometric transformation can be found <a href="https://github.com/facebookexperimental/Robyn/blob/main/R/R/transformation.R#L57" target="_blank" rel="noopener noreferrer">here</a> and is shown conceptually as followed:</p><img loading="lazy" alt="Geometric Formula" src="/Robyn/img/geometric.png" class="img_ev3q"><p>  Some rule of thumb estimates we have found from historically building weekly-level models are that  TV has tended to have adstock between 0.3 - 0.8, OOH/Print/Radio has had 0.1-0.4, and Digital has had 0.0 - 0.3. This is anecdotal advice so please use your best judgement when building your own models.</p><img loading="lazy" alt="Example Geometric Adstocks" src="/Robyn/img/adstockintro.png" class="img_ev3q"><p>Another useful property of Geometric decay is that the limit of the inifinite sum is equal to <code>1 / (1 - theta)</code>. For example, when theta = 0.75, its infinite sum is 4. Because Robyn conducts adstock transformation on spends, it can give you a quick and inituitive idea of how much &quot;inflation&quot; the adstock transformation will add on your raw data.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="weibull-pdf--cdf">Weibull PDF &amp; CDF:<a href="#weibull-pdf--cdf" class="hash-link" aria-label="Direct link to Weibull PDF &amp; CDF:" title="Direct link to Weibull PDF &amp; CDF:">â€‹</a></h4><p>Robyn offers the two-parametric Weibull function in the formats of PDF and CDF. Compared to the one-parametric Geometric function where theta is equal to the fixed decay rate, Weibull produces time-varying decay rates through more flexibility in the transformation with the parameters shape and scale. Robyn&#x27;s implementation of Weibull transformation can be found <a href="https://github.com/facebookexperimental/Robyn/blob/main/R/R/transformation.R#L123" target="_blank" rel="noopener noreferrer">here</a> and is shown conceptually as followed. Note that the theta from Weibull is time-dependent.</p><img loading="lazy" alt="Weibull Formula" src="/Robyn/img/weibull.png" class="img_ev3q"><p>The plot below shows the flexibility of Weibull adstocks with regard to the two parameters shape and scale. This flexibility does come at a cost of more computational power due to the extra hyperparameter. Especially Weibull PDF is strongly recommmended when the product is considered to have longer conversion window. We&#x27;ve seen Weibulll PDF leading to considerabaly better fit in some cases.</p><img loading="lazy" alt="Example Weibull Adstocks" src="/Robyn/img/weibulladstocks.png" class="img_ev3q"><p> <strong>Weibull CDF adstock:</strong> The Cumulative Distribution Function of Weibull has two parmeters
, shape &amp; scale, and has flexible decay rate, compared to Geometric adstock with fixed
decay rate. The shape parameter controls the shape of the decay curve. Recommended
bound is c(0.0001, 2). The larger the shape, the more S-shape. The smaller, the more
L-shape. Scale controls the inflexion point of the decay curve. We recommend very
conservative bounce of c(0, 0.1), because scale increases the adstock half-life greatly.</p><p><strong>Weibull PDF adstock:</strong> The Probability Density Function of the Weibull also has two
parameters, shape &amp; scale, and also has flexible decay rate as Weibull CDF. The
difference is that Weibull PDF offers lagged effect. When shape &gt; 2, the curve peaks
after x = 0 and has NULL slope at x = 0, enabling lagged effect and sharper increase and
decrease of adstock, while the scale parameter indicates the limit of the relative
position of the peak at x axis; when 1 &lt; shape &lt; 2, the curve peaks after x = 0 and has
infinite positive slope at x = 0, enabling lagged effect and slower increase and decrease
of adstock, while scale has the same effect as above; when shape = 1, the curve peaks at
x = 0 and reduces to exponential decay, while scale controls the inflexion point; when
0 &lt; shape &lt; 1, the curve peaks at x = 0 and has increasing decay, while scale controls
the inflexion point. When all possible shapes are relevant, we recommend c(0.0001, 10)
as bounds for shape; when only strong lagged effect is of interest, we recommend
c(2.0001, 10) as bound for shape. In all cases, we recommend conservative bound of
c(0, 0.1) for scale. Due to the great flexibility of Weibull PDF, meaning more freedom
in hyperparameter spaces for Nevergrad to explore, it also requires larger iterations
to converge.</p><p><strong>Implementation of adstocking is done in a few steps</strong></p><ol><li>In <code>InputCollect</code> set <code>adstock</code> equal to the distribution you plan to use (geometric, weibull_cdf, weibull_pdf)</li><li>Run <code>hyper_names(adstock = InputCollect$adstock, all_media = InputCollect$all_media)</code> to identify the hyperparameters that will need to be set up correctly in order to begin the modeling process. All paid and organic media variables will have hyper parameters that need to be set up.</li><li>Set ranges for each hyperparameter</li></ol><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="diminishing-returns-saturation">Diminishing returns (Saturation)<a href="#diminishing-returns-saturation" class="hash-link" aria-label="Direct link to Diminishing returns (Saturation)" title="Direct link to Diminishing returns (Saturation)">â€‹</a></h3><p>The theory of diminishing returns holds that each additional unit of advertising
increases the response, but at a declining rate. This key marketing principle is
reflected in marketing mix models as a variable transformation.</p><img loading="lazy" alt="Diminishing returns1" src="/Robyn/img/diminishingreturns1.png" class="img_ev3q"><p>The nonlinear response to a media variable on the dependent variable can be
modelled using a variety of functions. For example, we can use a simple
logarithm transformation (taking the log of the units of advertising log(x) ),
or a power transformation (x^alpha). In the case of a power transformation, the
modeler tests the different variables (different levels of parameter alpha) for the
highest significance of the variable in the model and the highest significance
of the equation overall. However, the most common approach is to use the
flexible S-curve (Hill) transformation:</p><img loading="lazy" alt="Diminishing returns1" src="/Robyn/img/diminishingreturns2.png" class="img_ev3q"><p>Note that the gamma in the equation is scaled to the inflexion point of variable in question. The variations of the parameters give modelers full flexibility on the look of the S-curve, specifically the shape and the inflection points:</p><img loading="lazy" alt="Diminishing returns1" src="/Robyn/img/diminishingreturns3.png" class="img_ev3q"><p>To understand these charts, on the x axis we have spend, and on the y-axis we have response. So as the spend rises, the response changes and depending on the curve we understand what the marginal response is. These curves are extremely useful in the end stages of MMM where we seek to understand how we can more optimally allocate budgets between all of our media channels.</p><p>Hill function for saturation: The Hill function is a two-parametric function in Robyn with
alpha and gamma. Alpha controls the shape of the curve between exponential and s-shape.
Recommended bound is c(0.5, 3). The larger the alpha, the more S-shape. The smaller, the
more C-shape. Gamma controls the inflection point. Recommended range is c(0.3, 1). The
larger the gamma, the later the inflection point in the response curve.</p><p><strong>Implementation in Robyn is all done in hyper parameter setting</strong></p><ol><li>Ensure you have a alpha and gamma hyper parameter for each paid media variable with a range specified</li></ol><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="meta-prophet">Meta Prophet<a href="#meta-prophet" class="hash-link" aria-label="Direct link to Meta Prophet" title="Direct link to Meta Prophet">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="automated-trend-seasonality-and-holiday-effect-decomposition">Automated trend, seasonality and holiday effect decomposition<a href="#automated-trend-seasonality-and-holiday-effect-decomposition" class="hash-link" aria-label="Direct link to Automated trend, seasonality and holiday effect decomposition" title="Direct link to Automated trend, seasonality and holiday effect decomposition">â€‹</a></h3><hr><p><strong>Prophet</strong> has been included in the code in order to improve the fit and forecast of
time-series by decomposing the effect of trend, seasonality and holiday
components in the response variable (Sales, conversions, etc.).</p><p><strong>Prophet</strong> is a Meta original procedure for <strong>forecasting time
series</strong> data, based on a model where <strong>non-linear trends</strong> are fit with yearly,
weekly, and daily seasonality, plus holiday effects. It works best with time
series that have strong seasonal effects and several seasons of historical data.
More details can be found <a href="https://facebook.github.io/prophet/docs/" target="_blank" rel="noopener noreferrer">here</a>.</p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prophet-decomposition-plot-example">Prophet decomposition plot example<a href="#prophet-decomposition-plot-example" class="hash-link" aria-label="Direct link to Prophet decomposition plot example" title="Direct link to Prophet decomposition plot example">â€‹</a></h3><p>Trend, season, holiday and an extra regressor (&quot;events&quot; in this case) decomposition by Prophet.
Weekday is not used because the sample data is weekly (not daily).
Robyn uses Prophet to also decompose categorical variables as an extra regressor which can simplify later programming.
For technical details of decomposition, please refer to Prophet&#x27;s documentation <a href="https://facebook.github.io/prophet/docs/trend_changepoints.html" target="_blank" rel="noopener noreferrer">here</a>.</p><img loading="lazy" alt="prophet 2" src="/Robyn/img/prophet_decomp.png" class="img_ev3q"><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ridge-regression">Ridge Regression<a href="#ridge-regression" class="hash-link" aria-label="Direct link to Ridge Regression" title="Direct link to Ridge Regression">â€‹</a></h2><p>In order to address multicollinearity among many regressors and prevent
overfitting we apply a regularization technique to reduce variance at the cost
of introducing some bias. This approach tends to improve the predictive
performance of MMMs. The most common regularization, and the one we are using in
this code is Ridge regression. The mathematical notation for Ridge regression
is:</p><img loading="lazy" alt="Ridge Regression Formula" src="/Robyn/img/Ridge.png" class="img_ev3q"><p>If we go a bit deeper into the actual components we will be using within the model specification,
besides the lambda penalization term above, we can identify the following formula:</p><img loading="lazy" alt="Ridge Regression Formula" src="/Robyn/img/model_specification.png" class="img_ev3q"><p>Ridge regression has an additional benefit of being relatively easy to interpret compared to other more complex techniques. As you can see in the formula, the hyperparameters that we set for each variable are used in this equation. As you&#x27;ll see in the following section, we use automated hyper parameter optimization in order to ensure we get the best fitting ridge regression model.</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="multi-objective-hyperparameter-optimization-with-nevergrad">Multi-Objective Hyperparameter Optimization with Nevergrad<a href="#multi-objective-hyperparameter-optimization-with-nevergrad" class="hash-link" aria-label="Direct link to Multi-Objective Hyperparameter Optimization with Nevergrad" title="Direct link to Multi-Objective Hyperparameter Optimization with Nevergrad">â€‹</a></h2><p>One of the most important innovation in Robyn is the implementation of multi-objective hyperparameter optimization in MMM. This enables us to automate the selection of adstocking, saturation, regularization penalty and even training size for time-series validation. At the same time, the ability to optimise towards multiple &quot;goals&quot;, implemented as objective functions, provides us the edge to produce model candidates with great predictive power as well as more realistic effect decomposition.</p><p>Robyn uses <a href="https://facebookresearch.github.io/nevergrad/" target="_blank" rel="noopener noreferrer"><strong>Nevergrad, Metaâ€™s gradient-free optimization platform</strong></a>, to perform this task with its <strong>ask</strong> and <strong>tell</strong> interface. In other words, Robyn &quot;asks&quot; Nevergrad for the mutating hyperparameter values by &quot;telling&quot; it which values have better scores (objective functions).</p><p><strong>Hyperparameters</strong>
There&#x27;re four types of hyperparameters in Robyn at the moment.</p><ul><li><strong>Adstocking</strong>: <code>theta</code> when selecting Geometric adstocking, or <code>shape</code> &amp; <code>scale</code> when selecting Weibull adstocking</li><li><strong>Saturation</strong>: <code>alpha</code> &amp; <code>gamma</code> for Hill function</li><li><strong>Regularization</strong>: <code>lambda</code> for the penalty term in ridge regression</li><li><strong>Validation</strong>: <code>train_size</code> for the percentage of training data
The cardinality of hyperparameters increases when adding more paid and organic media variables, because Robyn performs adstocking &amp; saturation transformation for each media variable individually. For example, if using 10 media variables with Geometric adstock, the total amount of hyperparameters is 32: 10 thetas + 10 alphas + 10 gammas + 1 lambda + 1 train_size. With Weibull adstock, it&#x27;s 42: 10 shapes + 10 scales + 10 alphas + 10 gammas + 1 lambda + 1 train_size. Adding hyperparameters will give Robyn more flexibility to find optimum solutions, but it will trade-off model runtime because it needs longer to converge.</li></ul><p><strong>Objective Functions</strong>
Robyn implements three objective functions as the &quot;goals&quot; for hyperparameter optimisation at the moment.</p><ul><li><strong>NRMSE</strong>: The Normalized Root Mean Square Error is also referred to as the <strong>prediction error</strong>. Robyn allows time-series validation with the spitting of the dataset into train / validation / test. To be precise, the validation NRMSE <code>nrmse_val</code> is the objective function, while <code>nrmse_test</code> is used to assess the out-of-sample preditive performance.</li><li><strong>DECOMP.RSSD</strong>: The Decomposition Root Sum of Squared Distance is also referred to as the <strong>business error</strong> and is a key invention of Robyn. It represents the difference between share of spend and share of effect for paid media variables. We&#x27;re aware that the hypothesis of driving homogenuous shares between spend &amp; effect is controvertial. In the reality, DECOMP.RSSD can rule out the most extreme decomposition results and thus is helpful for narrowing down model selection. It&#x27;s important to remember that all objective functions &quot;work together&quot; and the results are always balanced.</li><li><strong>MAPE.LIFT</strong>: The Mean Absolute Percentage Error for experiments is activated when calibrating and is referred to as the <strong>calibration error</strong>. It&#x27;s a key invention of Robyn and allows Robyn to minimise the difference between predicted effect and causal effect.</li></ul><p>Using the concept of Pareto-optimality balancing all objective functions, Robyn always outputs a set of pareto-optimum model candidates that are considered &quot;the best&quot;. Please find below an example of an example chart of the Pareto model solutions.
Each dot in the chart represents an explored model solution, while the lower-left corner lines are Pareto-fronts 1-3 and contains the best possible model results from all iterations.
The two axes (NRMSE on x and DECOMP.RSSD on y) are the two objective functions to be minimized.
As the iteration increases, a trend down the lower-left corner of the coordinate can be clearly observed.
This is a proof of Nevergrad&#x27;s ability to drive the model result towards an optimal direction.</p><img loading="lazy" alt="pareto chart" src="/Robyn/img/pareto_front.png" class="img_ev3q"><p>The premise of an <strong>evolutionary algorithm</strong> is that of natural selection. In an evolutionary algorithm you may have a set of iterations where some combinations of coefficients that will be explored by the model will survive and proliferate, while unfit models will die off and not contribute to the gene pool of further generations, much like in natural selection.
In robyn, we recommend a minimum of 2000 iterations where each of these will provide feedback to its upcoming generation, and therefore guide the model towards the optimal coefficient values for alphas, gammas and thetas. We also recommend a minimum of 5 trials which are a set of independent initiations of the model that will each of them have the number of iterations you set under â€˜set_iterâ€™ object. E.g. 2000 iterations on set_iter x 5 trials = 10000 different iterations and possible model solutions.</p><p>In Robyn, we consider the model to be converged <strong> UNDER REVISION </strong> when:</p><p>Criteria #1:
Last quantile&#x27;s standard deviation &lt; first 3 quantiles&#x27; mean standard deviation</p><p>Criteria #2:
Last quantile&#x27;s absolute median &lt; absolute first quantile&#x27;s absolute median - 2 * first 3 quantiles&#x27; mean standard deviation</p><p>The quantiles are ordered by the iterations of the model, so if we ran 1000 iterations, the first 200 iterations would make up the first quantile. These two criteria represent an effort to demonstrate that both the standard deviation and the mean for both NRMSE and DECOMP.RSSD have improved relative to where they began, and they are not as variable.</p><p>After the modeling is complete, you can run:</p><p><code>OutputModels$convergence$moo_distrb_plot</code></p><p><code>OutputModels$convergence$moo_cloud_plot</code></p><p>To investigate the convergence of your multi-objective optimization. See below for examples of these graphs.</p><img loading="lazy" alt="moo distrb plot" src="/Robyn/img/moo_distrb_plot.png" class="img_ev3q"><img loading="lazy" alt="moo cloud plot" src="/Robyn/img/moo_cloud_plot.png" class="img_ev3q"><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="time-series-validation">Time Series Validation<a href="#time-series-validation" class="hash-link" aria-label="Direct link to Time Series Validation" title="Direct link to Time Series Validation">â€‹</a></h2><p>When <code>ts_validation = TRUE</code> in <code>robyn_run()</code> a 3-way-split time series for NRMSE validation is enabled.
A time series validation parameter <code>train_size</code> is included as one of Robyn&#x27;s hyperparameters. When <code>ts_validation = TRUE</code> in <code>robyn_run()</code>, <code>train_size</code> defines the percentage of data used for training, validation and out-of-sample testing. For example, when <code>train_size = 0.7</code>, <code>val_size</code> and <code>test_size</code> will be 0.15 each. This hyperparameter is customizable or can be fixed with a default range of <code>c(0.5, 0.8)</code> and must be between <code>c(0.1, 1)</code>.</p><img loading="lazy" alt="time series validation" src="/Robyn/img/time_series_validation_and_convergence.png" class="img_ev3q"><img loading="lazy" alt="time series validation" src="/Robyn/img/actual_vs_predicted_response_ts.png" class="img_ev3q"><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="calibration-with-experiments">Calibration with Experiments<a href="#calibration-with-experiments" class="hash-link" aria-label="Direct link to Calibration with Experiments" title="Direct link to Calibration with Experiments">â€‹</a></h2><p>By applying results from randomized controlled-experiments, you may improve the
accuracy of your marketing mix models dramatically. It is recommended to run
these on a recurrent basis to keep the model calibrated permanently. In general,
we want to compare the experiment result with the MMM estimation of a marketing
channel. Conceptually, this method is like a Bayesian method, in which we use
experiment results as a prior to shrink the coefficients of media variables. A
good example of these types of experiments is Facebookâ€™s conversion lift tool
which can help guide the model towards a specific range of incremental values.</p><img loading="lazy" alt="Calibration chart" src="/Robyn/img/calibration1.png" class="img_ev3q"><p>The figure illustrates the calibration process for one MMM candidate model.
<a href="https://facebookresearch.github.io/nevergrad/" target="_blank" rel="noopener noreferrer"><strong>Facebookâ€™s Nevergrad gradient-free optimization platform</strong></a> allows us to include the <strong>MAPE(cal,fb)</strong> as a third optimization score besides Normalized Root Mean Square Error (<strong>NRMSE</strong>) and <strong>decomp.RSSD</strong> ratio (Please refer to the automated hyperparameter selection and optimization for further details) providing a set of <strong>Pareto optimal model solutions</strong> that minimize and converge to a set of Pareto optimal model candidates. This calibration method can be applied to other media channels which run experiments, the more channels that are calibrated, the more accurate the MMM model.</p><p><strong>Implementation of calibration is as follows</strong></p><ol><li>Create a data file corresponding to your experimental results - here is an example</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">calibration_input &lt;- data.frame(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # channel name must in paid_media_vars</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  channel = c(&quot;facebook_S&quot;,  &quot;tv_S&quot;, &quot;facebook_S&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # liftStartDate must be within input data range</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  liftStartDate = as.Date(c(&quot;2018-05-01&quot;, &quot;2018-04-03&quot;, &quot;2018-07-01&quot;)),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # liftEndDate must be within input data range</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  liftEndDate = as.Date(c(&quot;2018-06-10&quot;, &quot;2018-06-03&quot;, &quot;2018-07-20&quot;)),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # Provided value must be tested on same campaign level in model and same metric as dep_var_type</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  liftAbs = c(400000, 300000, 200000),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # Spend within experiment: should match within a 10% error your spend on date range for each channel from dt_input</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  spend = c(421000, 7100, 240000),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # Confidence: if frequentist experiment, you may use 1 - pvalue</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  confidence = c(0.85, 0.8, 0.99),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # KPI measured: must match your dep_var</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  metric = c(&quot;revenue&quot;, &quot;revenue&quot;, &quot;revenue&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><p>Set <code>calibration_input &lt;- dt_calibration</code> (or whatever you name your calibration data frame) within InputCollect</p></li><li><p>Increase your iteration count by at least 1000 to account for needing to optimize 3 objective functions (NRMSE, Decomp.RSSD, MAPE.lift) rather than 2 (NRMSE, Decomp.RSSD)</p></li><li><p>Run model</p></li></ol><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="outputs--diagnostics">Outputs &amp; Diagnostics<a href="#outputs--diagnostics" class="hash-link" aria-label="Direct link to Outputs &amp; Diagnostics" title="Direct link to Outputs &amp; Diagnostics">â€‹</a></h2><p>The MMM code will automatically generate a set of plots under the folder you specify on the â€˜model_output_collectâ€™ object. Each of these plots represents one of the optimal model solutions as a result of the multi-objective optimization Pareto optimal process mentioned in the <strong>â€˜Automated hyperparameter selection and optimizationâ€™</strong> section. Please find below an example of the model output:</p><img loading="lazy" alt="ModelResults1 chart" src="/Robyn/img/modelresults2.png" class="img_ev3q"><p>As you may observe we have 6 different charts above:</p><ol><li><p><strong>Response decomposition waterfall by predictor:</strong> This chart reflects the percentage of each of the variables effect (Baseline and Media variables + intercept) on the response variable. E.g. If newsletter effect says it&#x27;s 9.6% that means that 9.6% of the total sales can be attributed to newsletter activations.</p><p>Tip: Intercept, and Prophet vars like trend can constitute a large portion of your decomp. This makes sense if your brand is established, as it is basically saying that you would still have a large baseline of sales without paid media spend.</p></li><li><p><strong>Share of spend vs. share of effect:</strong> This plot reflects the comparison of the total effect each channel had by means of the decomposition of the coefficients into the response variable divided by the total effect. As well as, the total spend (cost or investment) each channel had and its relative share over total marketing spend. We also plot the return on investment (ROI) each channel had which can give you an idea over the most profitable channels.</p><p>Tip: Decomp.RSSD is one of the objective functions we minimize which corresponds to the distance between share of spend and share of effect. So in essence we do not want to see extreme distances between share of spend and share of effect because it does not make realistic business sense to optimize to. Consider this when comparing model solutions.</p></li><li><p><strong>Average adstock decay rate:</strong> This chart represents, on average, what is the percentage decay rate each channel had. The higher the decay rate, the longer the effect in time for that specific channel media exposure. This is a simple calculation for Geometric adstocks, with average adstock decay rate = theta. For Weibull adstocks this calculation is a bit more complicated.</p><p>Tip: It can be useful to look at the adstock rates in comparison to each other. For example, how do your upper funnel channel adstocks compare to your lower funnel channel adstocks. There are some logical conclusions to make about upper funnel having longer adstocks than lower funnel, so keep an eye out for cases where it doesn&#x27;t seem to be the case. This isn&#x27;t a hard and fast rule, but can be a way to differentiate between solutions.</p></li><li><p><strong>Actual vs. predicted response:</strong> This plot shows the actual data for the response variable E.g sales, and how the modeled predicted data for that response variable is capturing the real curve. We aim for models that can capture most of the variance from the actual data and therefore the R-squared is closer to 1 while NRMSE is low.</p><p>Tip: Look for specific periods where the model is predicting worse/better. For example, if one notices the model is predicting noticeably worse around certain periods related to promotions periods, it may be a good way to identify a contextual variable that should be included in the model</p></li><li><p><strong>Response curves and mean spend by channel:</strong> These are the diminishing returns response curves from hill function. They represent how saturated a channel is and therefore, may suggest potential budget reallocation strategies. The faster the curves reach to an inflection point and to a horizontal/flat slope, the quicker they will saturate with each extra ($) spent.</p><p>Tip: You can use the <code>robyn_response</code> function in a loop to recreate these response curves. For example, creating a loop around an execution like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Spend1 &lt;- 60000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Response1 &lt;- robyn_response(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">robyn_object = robyn_object</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#, select_build = 1 # 2 means the second refresh model. 0 means the initial model</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">, media_metric = &quot;search_S&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">, metric_value = Spend1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Response1$response/Spend1 # ROI for search 80k</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>Fitted vs. residual:</strong> This chart shows the relationship between fitted and residual values. A residual value is a measure of how much a regression line vertically misses a data point.  A residual plot is typically used to find problems with a regression. Some data sets are not good candidates for regression, such as points at widely varying distances from the line. If the points in a residual plot are randomly dispersed around the horizontal axis, a linear regression model is appropriate for the data; otherwise, a nonlinear model is more appropriate.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="model-solution-clustering">Model Solution Clustering<a href="#model-solution-clustering" class="hash-link" aria-label="Direct link to Model Solution Clustering" title="Direct link to Model Solution Clustering">â€‹</a></h3><p>Rather than exploring all Pareto-optimal solutions (of which there could be dozens), we use clustering to find similar solutions and encourage users to explore those solutions as the most distinct, best solutions. The process for the clustering is as follows:</p><ol><li>Using the pool of models on Pareto fronts obtained, we run k-means clustering using (normalized) ROI data on each (paid) media variable</li><li>When <code>k = &quot;auto&quot;</code> (which is the default), we calculate the WSS (Within Group Sum of Squares) on k-means clustering using k = 1 to k = 20 to find the &quot;best automatic k&quot;. We pick the one k whose WSS reduction doesn&#x27;t change more than 5% from the previous k. You could also override this by setting k manually (on <code>robyn_run(..., cluster = TRUE)</code>, <code>robyn_outputs(..., clusters = TRUE)</code>, or <code>robyn_clusters()</code>).</li><li>After we have run k-means on all Pareto front models, using the defined k, we pick those &quot;best models&quot; that have the lowest normalized combined errors (NRMSE, DECOM.RSSD, and MAPE if calibrated was used).</li></ol><p>When you run robyn_clusters() you&#x27;ll get a list of results: the data used to calculate the clusters with each model&#x27;s cluster-ID, and some visualizations on WSS-k selection, ROI per media on winner models, and correlations of ROI by cluster to understand each cluster&#x27;s content models better. See below for example output on clustering selection.</p><img loading="lazy" alt="Pareto clusters WSS" src="/Robyn/img/pareto_clusters_wss.png" class="img_ev3q"><img loading="lazy" alt="Pareto cluster details" src="/Robyn/img/pareto_clusters_detail.png" class="img_ev3q"><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="budget-allocation">Budget Allocation<a href="#budget-allocation" class="hash-link" aria-label="Direct link to Budget Allocation" title="Direct link to Budget Allocation">â€‹</a></h3><p>Once you have analyzed the optimal model results plots and have chosen your model, you may introduce the model unique ID from the results in the previous section. E.g setting select_model = &quot;1_92_12&quot; could be an example of a selected model from the list of best models in &#x27;OutputCollect$allSolutions&#x27; results object. Once you run the budget allocator, results will be plotted and saved under the same folder where the model plots had been saved. The result would look like the following:</p><img loading="lazy" alt="budget allocator chart" src="/Robyn/img/optimizer_new.png" class="img_ev3q"><p>You may encounter three charts as in the example above:</p><ol><li><strong>Initial vs. optimized budget allocation:</strong> This channel shows the original spend share vs. the new optimized recommended one. If optimized share is greater than original, this would mean you will need to proportionally increase budgets for that channel according to the difference between both shares. And you would reduce budgets in the case spend share would be greater than optimized share.</li><li><strong>Initial vs. optimized mean response:</strong> Similar to the chart above, we have initial and optimized shares, but this time over the total expected response E.g. Sales. The optimized response is the total increase in sales that we are expecting you to have if you switch budgets following the chart we explained above, increasing those with better share for optimized spend and decreasing spend for those with lower optimized spend than the initial.</li><li><strong>Response curve and mean spend by channel:</strong> These again are the diminishing returns response curves from hill function. They represent how saturated a channel is and therefore, may suggest potential budget reallocation strategies. The faster the curves reach to an inflection point and to a horizontal/flat slope, the quicker they will saturate with each extra ($) spent. The initial mean spend is represented by a circle and the optimized one by the triangle.</li></ol><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="continuous-reporting">Continuous Reporting<a href="#continuous-reporting" class="hash-link" aria-label="Direct link to Continuous Reporting" title="Direct link to Continuous Reporting">â€‹</a></h2><hr><p>Another strong capability requirement linked to the model window we identified, is the ability to refresh the model when new data would arrive. In other words, to be able to continuously report in a monthly, weekly or even daily frequency, based on a previously selected model but applied onto new fresh data. Consequently, enabling MMM to be a continuous reporting tool for actionable and timely decision-making that could feed your reporting or BI tools within the defined cadence.</p><p>The new <code>robyn_refresh()</code> function is able to continuously build and add new model periods, at any given cadence (weeks, months, etc.), based on previously selected models saved in the Robyn.RData object specified in the robyn_object.</p><p>For example, when updating the initial build with 4 weeks of new data, robyn_refresh() consumes the selected model of the initial build. What Robyn does is to set lower and upper bounds of hyperparameters for the new build which are consistent with the selected hyperparameters of the previous build. Therefore, stabilizing the effect of contextual and organic variables across old and new builds as well as, regulating the new share of effect of media variables towards the new added period spend level. Finally, returning aggregated results containing all previous builds for reporting purposes and their corresponding plots.</p><hr><p>The example below shows the model refreshing mechanism for 5 different periods of time based in an initial window covering most of 2017 and 2018:</p><img loading="lazy" alt="pareto chart 2" src="/Robyn/img/refresh-window.png" class="img_ev3q"><hr><p>You will also obtain a set of results for each refresh period that describes the assigned ROI and effects from each of the variables within the model. The baseline variable is the sum of all prophet variables (trend, seasonality, weekday and holiday) plus the intercept. The charts are based on simulated and do not have real-life implication:</p><img loading="lazy" alt="pareto chart 2" src="/Robyn/img/refresh-reporting.png" class="img_ev3q"><hr><h4 class="anchor anchorWithStickyNavbar_LWe7" id="robyn_refresh-description"><code>robyn_refresh()</code> description<a href="#robyn_refresh-description" class="hash-link" aria-label="Direct link to robyn_refresh-description" title="Direct link to robyn_refresh-description">â€‹</a></h4><p>The <code>robyn_refresh()</code> function builds updated models based on the previously built models saved in the Robyn.RData object specified in robyn_object.
For example, when updating the initial build with 4 weeks of new data, <code>robyn_refresh()</code> consumes the selected model of the initial build.</p><p>What Robyn does, is to set lower and upper bounds of hyperparameters for the new build around the selected hyperparameters of the previous build,
stabilizes the effect of baseline variables across old and new builds and regulates the new effect share of media variables towards the latest spend level.
It returns aggregated results with all previous builds for reporting purposes and produces reporting plots.</p><hr></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebookexperimental/Robyn/edit/main/website/docs/features2.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/Robyn/docs/analysts-guide-to-MMM"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Analysts guide to MMM</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Robyn/docs/releases"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Releases</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#model-inputs" class="table-of-contents__link toc-highlight">Model Inputs</a><ul><li><a href="#paid-media-variables" class="table-of-contents__link toc-highlight">Paid Media Variables</a></li><li><a href="#organic-variables" class="table-of-contents__link toc-highlight">Organic Variables</a></li><li><a href="#contextual-variables" class="table-of-contents__link toc-highlight">Contextual Variables</a></li></ul></li><li><a href="#variable-transformations" class="table-of-contents__link toc-highlight">Variable Transformations</a><ul><li><a href="#adstock" class="table-of-contents__link toc-highlight">Adstock</a></li><li><a href="#diminishing-returns-saturation" class="table-of-contents__link toc-highlight">Diminishing returns (Saturation)</a></li></ul></li><li><a href="#meta-prophet" class="table-of-contents__link toc-highlight">Meta Prophet</a><ul><li><a href="#automated-trend-seasonality-and-holiday-effect-decomposition" class="table-of-contents__link toc-highlight">Automated trend, seasonality and holiday effect decomposition</a></li><li><a href="#prophet-decomposition-plot-example" class="table-of-contents__link toc-highlight">Prophet decomposition plot example</a></li></ul></li><li><a href="#ridge-regression" class="table-of-contents__link toc-highlight">Ridge Regression</a></li><li><a href="#multi-objective-hyperparameter-optimization-with-nevergrad" class="table-of-contents__link toc-highlight">Multi-Objective Hyperparameter Optimization with Nevergrad</a></li><li><a href="#time-series-validation" class="table-of-contents__link toc-highlight">Time Series Validation</a></li><li><a href="#calibration-with-experiments" class="table-of-contents__link toc-highlight">Calibration with Experiments</a></li><li><a href="#outputs--diagnostics" class="table-of-contents__link toc-highlight">Outputs &amp; Diagnostics</a><ul><li><a href="#model-solution-clustering" class="table-of-contents__link toc-highlight">Model Solution Clustering</a></li><li><a href="#budget-allocation" class="table-of-contents__link toc-highlight">Budget Allocation</a></li></ul></li><li><a href="#continuous-reporting" class="table-of-contents__link toc-highlight">Continuous Reporting</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebookexperimental/Robyn" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/business/success/resident" target="_blank" rel="noopener noreferrer" class="footer__link-item">Case study: Resident<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/business/success/central-retail-corporation" target="_blank" rel="noopener noreferrer" class="footer__link-item">Case study: Central Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/business/measurement/case-studies/bark" target="_blank" rel="noopener noreferrer" class="footer__link-item">Case study: Bark<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.facebook.com/groups/954715125296621" target="_blank" rel="noopener noreferrer" class="footer__link-item">Robyn MMM Users Facebook Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebookexperimental/Robyn/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Raise an issue on Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/Robyn/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/Robyn/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2023 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/Robyn/assets/js/runtime~main.8e2b16e5.js"></script>
<script src="/Robyn/assets/js/main.4504c918.js"></script>
</body>
</html>